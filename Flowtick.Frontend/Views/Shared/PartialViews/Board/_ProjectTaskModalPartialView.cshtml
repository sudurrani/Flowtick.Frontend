<style>
    .task-code {
        font-weight: 400;
        font-size: 0.85rem;
    }

        .task-code:hover {
            cursor: pointer !important;
            transform: translateY(-1px);
            /* box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); */
            text-decoration: underline;
        }

    .child-panel-content {
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        /*  overflow: hidden; */
    }

    .child-table {
        width: 100%;
        border-collapse: collapse;
    }

        .child-table tr td, th {
            padding-top: 0.2rem !important;
            padding-bottom: 0.2rem !important;
            padding-left: 0.3rem !important;
            padding-right: 0.3rem !important;
        }


    /* ===== MODAL Design Start ===== */
    .task-modal {
        position: fixed;
        inset: 0;
        background: rgba(140, 144, 152, 0.75);
        display: flex;
        justify-content: center;
        align-items: center;
        /*    backdrop-filter: blur(3px);*/
        z-index: 9999;
        overflow: auto;
        padding: 20px;
    }


    /* ===== MODAL BOX ===== */
    .task-modal-box {
        width: 1265px;
        max-width: 89%;
        height: 610px;
        max-height: 100%;
        background: #FFFFFF;
        border-radius: 4px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        /*    box-shadow: 0 8px 30px rgba(0,0,0,0.15);*/
    }

    /* ===== HEADER ===== */
    .task-modal-header {
        display: flex;
        align-items: center;
        padding: 0px 16px;
        gap: 12px;
        width: 100%;
        border-bottom: 1px solid #E3E6EA;
        background: #fff;
        position: sticky;
        top: 0;
        z-index: 1;
        justify-content: space-between;
    }

    /* HEADER ICONS LEFT & RIGHT */
    .header-left-icons,
    .header-right-icons {
        display: flex;
        align-items: center;
        gap: 8px;
    }

        .header-left-icons .icon-btn,
        .header-right-icons .icon-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 4px 6px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: background 0.2s;
        }

            .header-left-icons .icon-btn:hover,
            .header-right-icons .icon-btn:hover {
                background: #F1F2F4;
            }

        .header-left-icons a.task-code {
            font-weight: 600;
            font-size: 14px;
            color: #5e6c84;
            text-decoration: none;
        }

            .header-left-icons a.task-code:hover {
                text-decoration: underline;
            }

    /* TASK ID */
    /*      .task-id {
                                                 background-color: #E2C6FF;
                                                 color: #5D3FD3;
                                                 font-weight: 600;
                                                 font-size: 14px;
                                                 padding: 6px 10px;
                                                 border-radius: 6px;
                                             } */

    /* TASK TITLE */
    .task-left .task-title {
        margin-bottom: 12px;
    }

    .task-left .task-title-input {
        font-size: 18px;
        font-weight: 600;
        border: none;
        outline: none;
        padding: 10px 0px 10px 0px;
        width: 100%;
        background: transparent;
    }

        .task-left .task-title-input:focus {
            border: 1px solid #00757D;
        }


    .header-right-icon {
        background: transparent;
        border: 1px solid #F1F2F4;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        width: 30px;
        height: 30px;
        margin-right: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #444;
        padding: 0;
        transition: background 0.2s;
    }

        .header-right-icon:hover {
            background: var(--primary-color);
            color: #fff;
        }

    /* ===== BODY ===== */
    .task-modal-body {
        flex: 1;
        display: flex;
        gap: 16px;
        padding: 16px 16px;
        background: #fff;
        overflow: hidden;
        padding-top: 3px;
    }

    /* ===== LEFT PANEL ===== */
    .task-left {
        width: 75%;
        overflow-y: auto;
        overflow-x: hidden;
        padding-right: 16px;
        /*    padding-left: 12px;*/
    }

    .section-title {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 12px;
    }

    .description-text {
        font-size: 14px;
        color: #5e6c84;
        cursor: pointer;
        padding: 6px 0;
    }

    /* EDITOR */
    #editor-toolbar {
        margin-bottom: 6px;
        border: 1px solid #dcdcdc;
        border-radius: 6px 6px 0 0;
    }

    #editorContainer {
        height: max-content;
        border: 1px solid #dcdcdc;
        border-top: none;
        border-radius: 0 0 6px 6px;
        padding: 10px;
        font-size: 14px;
    }

    /* ACTION BUTTONS */
    .action-buttons {
        margin-top: 12px;
        display: flex;
        gap: 8px;
    }

    .primary-button {
        background: #0052cc;
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
    }

    .cancel-button {
        border: 1px solid #dcdcdc;
        background: #FFFFFF;
        padding: 0px 6px;
        border-radius: 4px;
        

    }

    /* PANELS */
    .panel-section {
        margin-top: 32px;
    }

    .panel-title {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 8px;
    }

    /* COMMENTS */
    .comment-box {
        width: 100%;
        height: 90px;
        border: 1px solid #dcdcdc;
        border-radius: 6px;
        padding: 8px;
        resize: none;
    }

    /* ===== RIGHT PANEL ===== */
    .task-right {
        width: 25%;
        display: flex;
        flex-direction: column;
        overflow-x: auto;
        overflow-y: auto;
    }

    /* Right panel scroll content wrapper */
    .right-scroll {
        flex: 1;
        overflow-y: auto;
        padding-right: 10px;
    }

    .status-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 16px;
    }

    .detail-block {
        margin-bottom: 18px;
    }

        .detail-block .label {
            font-size: 16px;
            font-weight: 700;
            color: #555;
        }

        .detail-block .value {
            font-size: 13px;
            color: #333;
        }

    .link-item {
        font-size: 13px;
        color: #0052cc;
        cursor: pointer;
    }

    /*
                                                 child work item table css */

    .child-panel {
        /* 		margin-top: 20px; */
    }

        /* Remove default triangle icon */
        .child-panel summary {
            list-style: none;
            cursor: pointer;
            padding: 10px 0px;
            display: flex;
            align-items: center;
        }



    /* Custom arrow icon */
    .arrow-icon {
        width: 12px;
        height: 12px;
        border-right: 2px solid #333;
        border-bottom: 2px solid #333;
        /* 		margin-right: 8px; */
        justify-content: center;
        transform: rotate(-42deg); /* v */
        transition: transform .2s ease;
    }

    /* Rotate arrow when opened */
    .child-panel[open] .arrow-icon {
        transform: rotate(45deg);
    }

    /* Panel content */
    .child-panel-content {
        padding: 0 0px 12px;
    }

    /* Table */
    .child-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

        .child-table th {
            text-align: left;
            padding: 8px 0;
            border-bottom: 1px solid #e3e6ea;
            font-weight: 600;
            color: #505258;
        }

        .child-table td {
            padding: 10px 0;
            border-bottom: 1px solid #f3f4f6;
        }
    /*child work add row css*/
    .child-add-wrapper {
        padding: 8px;
    }

    #subTaskForm {
        display: contents;
    }

    .child-task-type {
        width: 120px;
    }

    .child-add-action {
        cursor: pointer;
        color: #6c757d;
    }

        .child-add-action span:hover,
        .child-add-action span:focus {
            color: #1868db;
            outline: 2px solid #1868db;
            outline-offset: 2px;
            border-radius: 4px; /* nice rounded border */
        }

    .child-add-row td {
        background: #fafafa;
        border-top: 1px solid #e0e0e0;
    }

    /*task editor css here*/
    .ql-editor:hover {
        background-color: #f0f0f0; /* light gray */
        transition: background-color 0.3s; /* smooth effect */
    }

    /*
       COMMENT DESIGN */

    .comments-container {
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 14px;
        background: #f8f9fb;
        border-radius: 8px;
        margin-top:6px;
    }

    .comment-item {
        display: flex;
        align-items: flex-start;
        max-width: 75%;
        gap: 8px;
    }

    /* Comment bubble */
    .comment-bubble {
        position: relative;
        padding: 6px 12px;
        border-radius: 12px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
        min-width: 260px;
        max-width: 100%;
    }

    /* Header */
    .comment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
    }

    .comment-user-img {
        width: 28px;
        height: 28px;
        min-width: 28px;
        min-height: 28px;
        border-radius: 50%;
        background: linear-gradient(135deg, #14b8a6, #0d9488);
        color: #ffffff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.625rem;
        font-weight: 500;
 

    }

    .comment-meta {
        font-size: 11px;
        color: #6b7280;
        display: flex;
        gap: 6px;
        white-space: nowrap;
    }

    /* Text inside comment bubble */
    .comment-text {
        font-size: 14px;
        color: #1f2937;
        line-height: 1.5;
        word-break: break-word; 
    }

        /* Images inside comment bubble */
        .comment-text img {
            max-width: 100%; 
            max-height: 300px; 
            width: auto; 
            height: auto; 
            border-radius: 8px;
            margin: 6px 0; 
            display: block;
        }

    /* LEFT comment bubble */
    .comment-item.left {
        align-self: flex-start;
        flex-direction: row;
        margin-right: auto;
    }

        .comment-item.left .comment-bubble {
            background: #e0f2fe;
        }

            .comment-item.left .comment-bubble::before {
                content: "";
                position: absolute;
                left: -8px;
                top: 14px;
                border-width: 8px 8px 8px 0;
                border-style: solid;
                border-color: transparent #e0f2fe transparent transparent;
            }

    /* RIGHT comment bubble */
    .comment-item.right {
        align-self: flex-end;
        flex-direction: row; 
        margin-left: auto;
    }

        .comment-item.right .comment-bubble {
            background: #dcfce7;
        }

            .comment-item.right .comment-bubble::before {
                content: "";
                position: absolute;
                left: -8px;
                top: 14px;
                border-width: 8px 8px 8px 0;
                border-style: solid;
                border-color: transparent #dcfce7 transparent transparent;
            }


</style>
<!-- Task Modal -->
<div class="task-modal" style="display:none">
    <input type="hidden" id="modalTaskID" />
    <input type="hidden" id="modalSubTaskID" />
    <div class="task-modal-box">

        <!-- HEADER -->
        <div class="task-modal-header">

            <!-- LEFT ICONS -->
            <div class="header-left-icons" style="display:flex; align-items:center; gap:0px;">
                @* <button class="icon-btn"><img src="your-uploaded-icon.png" alt="icon" style="width:20px;height:20px;"></button> *@
                @* <i class="bi bi-lightning-charge task-icon"></i> *@
                <!-- project Epics dropdown  dropdown -->
                <div class="dropdown d-flex align-items-center" id="epicParentLinkDropdown">
                    <div class="dropdown-toggle no-caret" data-bs-toggle="dropdown" id="epicDropdown">
                        <div class=" d-flex align-items-center">
                            <div id="epicParentLink" style="cursor:pointer;" class="selected-epic-code "><i class="bi bi-lightning-charge task-icon" id="epicParentLinkIcon"></i><span class="task-code">no-parent</span></div>
                        </div>
                    </div>
                    <i class="bi bi-slash-lg link-icon" style="transform: rotate(-20deg);font-size:15px;font-weight:600 !important;"></i>
                    <div class="dropdown-menu flowtick-dropdown" style="width:365px">
                        <div class="flowtick-dropdown-search">
                            <i class="bi bi-search"></i>
                            <input type="text" class="seach-user-dropdown" placeholder="Search Epic">
                        </div>

                        <ul class="dropdown-list project-epics-list"></ul>
                    </div>

                </div>

                <div class="dropdown">
                    <a class="text-decoration-none  no-caret dropdown-toggle " data-bs-toggle="dropdown" id="" tabindex="0">
                        <span id="modalTaskTypeIcon" style="cursor:pointer;"><i></i></span>
                    </a>

                    <ul class="dropdown-menu task-type-menu">
                        <!-- Dynamic items will load here -->
                    </ul>
                </div>
                <span href="#" class="task-code ms-1" id="modalTaskCode"></span>
            </div>

            <!-- RIGHT ICONS -->
            <div class="header-right-icons" style="margin-left:auto; display:flex; align-items:center; gap:8px; padding-top:2px; padding-bottom:2px;">
                @* <button id="updateTask" class="primary-button" style="background-color:#00757D; margin-right:10px; padding:4px 12px;"> <i class="bi bi-plus text-white "></i> Save</button> *@
                <span class="header-right-icon">	<i class="bi bi-eye"></i></span>
                <span class="header-right-icon">	<i class="bi bi-share"></i></span>
                <span class="header-right-icon"><i class="bi bi-three-dots"></i></span>
                <span class="header-right-icon"><i class="bi bi-arrows-angle-contract"></i></span>
                <span class="header-right-icon" onclick="closTaskModal();"><i class="bi bi-x-lg btn-close-modal"></i></span>
            </div>

        </div>

        <!-- BODY -->
        <div class="task-modal-body">

            <!-- LEFT PANEL -->
            <div class="task-left">

                <!-- TASK TITLE MOVED HERE -->
                <div class="task-title" style="margin-bottom:12px;">
                    <input type="text" class="task-title-input" value="Landlord Management v1.0" id="modalTaskTitle" />
                </div>

                <label class="section-title">Description</label>

                <div id="description-view">
                    <div id="description-display" class="description-text">
                        Edit description
                    </div>
                </div>
                @await Html.PartialAsync(
                         "~/Views/Shared/PartialViews/Common/_EditorPartialView.cshtml",
                         new Flowtick.Frontend.Models.EditorPartialView.EditorPartialViewInputModel
                {
                    IdAttr = "DescriptionEditor"
                })



                <div class="row mt-1">
                    <div class="col-10">
                       
                    </div>
                    <div class="col-2 text-end">
                        @* <div class="action-buttons"> *@
                            <button id="updateTask" class="btn-create"><i class="bi bi-plus"></i>Save</button>
                            @* 	<button id="cancel-description" class="cancel-button">Cancel</button> *@
                        @* </div> *@
                    </div>
                </div>
                @await Html.PartialAsync(
                         "~/Views/Shared/PartialViews/Common/_FileUploadPartialView.cshtml"
                         )

                
                <!-- CHILD ITEMS -->
                <div class="panel-section" id="childWorkPanel">
                    <details class="child-panel">
                        <summary class="panel-title d-flex align-items-center justify-content-between">

                            <!-- LEFT SIDE: Arrow + Title -->
                            <div class="d-flex align-items-center gap-2" style="color:var(--primary-color)">
                                <span class="header-right-icon"> <i class="arrow-icon"></i></span>
                                <span>Child work items</span>
                            </div>

                            <!-- RIGHT SIDE: Icons -->
                            <div class="d-flex align-items-center gap-3">

                                <!-- Three dots -->
                                <span class="right-icon more-options">
                                    <span class="header-right-icon"> <i class="bi bi-three-dots"></i></span>
                                </span>

                                <!-- Configuration -->
                                @* 								<span class="right-icon config-icon">
                                <span class="header-right-icon"><i class="bi bi-gear"></i></span>
                                </span> *@

                                <!-- Plus -->
                                <span class="right-icon " id="btnAddChildWork">
                                    <span class="header-right-icon"><i class="bi bi-plus-lg"></i></span>
                                </span>

                            </div>

                        </summary>

                        <div class="child-panel-content">
                            <table class="child-table" style="width:100%">
                                <thead>
                                    <tr>
                                        <th style="width:50%">Work</th>
                                        <th style="width:15%">Priority</th>
                                        @* <th style="width:25%">Story</th> *@
                                        <th style="width:20%">Assignee</th>
                                        <th style="width:15%">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="childWorkTableTbody">
                                    @* 			<tr>
                                    <td>
                                    <i class="bi bi-check-square me-2" style="color:#4E8CE3"></i>
                                    <span class="task-no">TASK-01</span>
                                    <span class="child-task-title">Build UI Layout</span>
                                    </td>
                                    <td>
                                    <i class="bi bi-filter " style="color:#E06C00"></i>
                                    Medium
                                    </td>
                                    <td>Add Story Points</td>
                                    <td>
                                    <img src="https://i.pravatar.cc/24" class="profile-img">
                                    Aman Ullah
                                    </td>
                                    <td>
                                    <select class="status-select">
                                    <option>To Do</option>
                                    <option>In Progress</option>
                                    <option>Review</option>
                                    <option>Done</option>
                                    </select>
                                    </td>
                                    </tr> *@
                                </tbody>
                            </table>
                        </div>
                    </details>

                </div>

                <!-- LINKED ITEMS -->
                <div class="panel-section">
                    <div class="panel-title">Linked work items</div>
                    <a class="link-item">Add linked work item</a>
                </div>



                <div class="container mt-5">
                    <div class="d-flex justify-content-between align-items-center tab-container">
                        <h6 class="mb-0 fw-bold tab-container">Activity</h6>
                        <!-- Tab Navigation -->
                        <ul class="nav nav-tabs tab-buttons" role="tablist">
                            <li class="nav-item" role="presentation">
                                <a class="nav-link " id="allTab" data-bs-toggle="tab" href="#allTabContent" role="tab">
                                    All
                                </a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link active" id="commentsTab" data-bs-toggle="tab" href="#commentsTabContent" role="tab">
                                    Comments
                                </a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="historyTab" data-bs-toggle="tab" href="#historyTabContent" role="tab">
                                    History
                                </a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="workLogTab" data-bs-toggle="tab" href="#workLogTabContent" role="tab">
                                    Work log
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Tab Content -->
                    <div class="tab-content">
                        <div class="tab-pane fade " id="allTabContent" role="tabpanel">
                            <h4>All</h4>

                        </div>
                        <div class="tab-pane fade show active" id="commentsTabContent" role="tabpanel">
                            <!-- COMMENTS -->
                            <div class="panel-section">
                              @*   <textarea class="comment-box">Add a Comment</textarea> *@
                                @await Html.PartialAsync(
                                         "~/Views/Shared/PartialViews/Common/_EditorPartialView.cshtml",
                                         new Flowtick.Frontend.Models.EditorPartialView.EditorPartialViewInputModel
                                {
                                    IdAttr = "Comment"
                                })
                                <button id="addComment" class="btn-create mt-2"><i class="bi bi-plus"></i>Save</button>
                   @*              	<button id="cancel-description" class="cancel-button">Cancel</button> *@

                                <!-- COMMENTS WRAPPER -->
                                <div class="comments-container">
                                    <!-- Dynamic comments will be appended here -->
                                </div>




                            </div>

                        </div>
                        <div class="tab-pane fade" id="historyTabContent" role="tabpanel">
                            <h4>history</h4>

                        </div>
                        <div class="tab-pane fade" id="workLogTabContent" role="tabpanel">
                            <h4>workLogTabContent</h4>
                        </div>
                    </div>
                </div>

            </div>

            <!-- RIGHT PANEL -->
            <div class="task-right">
                <div class="status-row">
                    <!-- Task staus dropdown -->
                    <div class="dropdown">
                        <a class="text-decoration-none dropdown-toggle btn-task-status btn-create fw-bold p-2 cursor-pointer" data-bs-toggle="dropdown" style="font-size: 0.8rem;">
                            <span id="taskStatusID"></span>
                        </a>
                        <ul class="dropdown-menu task-status-list select-status">
                            <!-- Dynamic items will load here -->
                        </ul>
                    </div>
                    <span class="header-right-icon"><i class="bi bi-lightning-charge task-icon"></i></span>
                </div>

                <div class="right-scroll">
                    <div class="detail-block">
                        <div class="label">Assignee</div>
                        <div class="dropdown mt-2">
                            <div class="dropdown-toggle no-caret" data-bs-toggle="dropdown">
                                <div class="selected-assignee d-flex align-items-center" id="modalAssigneeID" style="cursor:pointer">
                                    @* selected value here *@
                                </div>
                            </div>
                            <div class="dropdown-menu flowtick-dropdown">
                                <div class="flowtick-dropdown-search">
                                    <i class="bi bi-search"></i>
                                    <input type="text" class="seach-user-dropdown" placeholder="Search users">
                                </div>
                                <ul class="dropdown-list asignee-user-list">
                                    @* 	dropdown list  here *@
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="detail-block">
                        <div class="label">Reviewer</div>
                        <div class="dropdown mt-2">
                            <div class="dropdown-toggle no-caret" data-bs-toggle="dropdown">
                                <div class="selected-reviewer d-flex align-items-center" id="modalReviewerID" style="cursor:pointer">
                                    @* selected value here *@
                                </div>
                            </div>

                            <div class="dropdown-menu flowtick-dropdown">
                                <div class="flowtick-dropdown-search">
                                    <i class="bi bi-search"></i>
                                    <input type="text" class="seach-user-dropdown" placeholder="Search users">
                                </div>

                                <ul class="dropdown-list reviewer-user-list">
                                    @* 	dropdown list  here *@
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="detail-block">
                        <div class="label">Reporter</div>
                        <div class="dropdown mt-2">
                            <div class="dropdown-toggle no-caret" data-bs-toggle="dropdown">
                                <div class="selected-reporter d-flex align-items-center" id="modalReporterID" style="cursor:pointer">
                                    @* selected value here *@
                                </div>
                            </div>
                            <div class="dropdown-menu flowtick-dropdown">
                                <div class="flowtick-dropdown-search">
                                    <i class="bi bi-search"></i>
                                    <input type="text" class="seach-user-dropdown" placeholder="Search users">
                                </div>
                                <ul class="dropdown-list reporter-user-list">
                                    @* 	dropdown list  here *@
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="detail-block">
                        <div class="label">Labels</div>
                        <a class="link-item">Add labels</a>
                    </div>

                    <div class="detail-block">
                        <div class="d-flex align-items-center">
                            <div class="label">Sprint </div>
                            <i class="bi bi-info-circle ms-2"></i>
                        </div>
                        <a class="link-item">Till - Dec-25</a>
                    </div>

                    <div class="detail-block">
                        <div class="label">Priority</div>

                        <div class="dropdown mt-2">
                            <span class="dropdown-toggle no-caret" data-bs-toggle="dropdown">
                                <i class="priority-icon bi bi-filter"
                                   style="color:#E06C00;"></i>
                                <span class="user-name ms-2 " id="selectedPriority">Medium</span>
                            </span>
                            <div class="dropdown-menu flowtick-dropdown">
                                <ul class="dropdown-list">

                                    <li class="dropdown-item priority-option">
                                        <i class="bi bi-chevron-double-up priority-icon-item"
                                           data-icon="bi bi-chevron-double-up"
                                           data-color="#4E8CE3" style="color:#4E8CE3"></i>
                                        <span class="user-name">Highest</span>
                                    </li>
                                    <li class="dropdown-item priority-option">
                                        <i class="bi bi-chevron-up priority-icon-item"
                                           data-icon="bi bi-chevron-up"
                                           data-color="#4E8CE3" style="color:#4E8CE3"></i>
                                        <span class="user-name">High</span>
                                    </li>
                                    <li class="dropdown-item priority-option">
                                        <i class="bi bi-filter priority-icon-item"
                                           data-icon="bi bi-filter"
                                           data-color="#E06C00" style="color:#E06C00"></i>
                                        <span class="user-name">Medium</span>
                                    </li>
                                    <li class="dropdown-item priority-option">
                                        <i class="bi bi-chevron-down priority-icon-item"
                                           data-icon="bi bi-chevron-down"
                                           data-color="#E06C00" style="color:#E06C00"></i>
                                        <span class="user-name">Low</span>
                                    </li>
                                    <li class="dropdown-item priority-option">
                                        <i class="bi bi-chevron-double-down priority-icon-item"
                                           data-icon="bi bi-chevron-double-down"
                                           data-color="#E06C00" style="color:#E06C00"></i>
                                        <span class="user-name">Lowest</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                    </div>

                </div>

            </div>

        </div>

    </div>

</div>
<script>
    $(function () {
        renderTinyMCE('#DescriptionEditor, #Comment');
        $('#modalTaskCode').click(function () {
            redirectToAction(`/Task/Detail?projectId=${encodeURIComponent(encryptNumber(projectId))}&id=`, $('#modalTaskID').val());
        })


        // Show editor by default
        $('#description-view').hide();
        $('#description-editor-wrapper').show();


        // Save description
        $('#save-description').on('click', function () {
            let html = quill.root.innerHTML;
            $('#description-display').text($(html).text());
            $('#description-editor-wrapper').hide();
            $('#description-view').show();
        });
        // editor js end



        $("#updateTask").click(function () {
            updateTask();
        });

       $("#addComment").click(function () {
          const taskId = $("#modalTaskID").val().trim();
            addComment(taskId);
        });
 
    })

    function closTaskModal() {
        $(".task-modal").fadeOut(200);
    }

    // handle click for assignee in modal
    $(document).on("click", ".asignee-user-list .dropdown-item", function () {

        let name = $(this).data("name");
        let userId = $(this).data("id");
        let avatar = `<div class="assignee-avatar-sm profile-image" data-user-id="${userId}">${getInitials(name)}</div>`;
        $(".selected-assignee").html(`${avatar} <span class="user-name ms-2">${name}</span> `);

        const taskId = $("#modalTaskID").val().trim();
        updateTaskAssignee(taskId, userId);
    });
    // handle click for reporter
    $(document).on("click", ".reporter-user-list .dropdown-item", function () {

        let name = $(this).data("name");
        let reporterId = $(this).data("id");

        let avatar = `<div class="assignee-avatar-sm profile-image" data-user-id="${reporterId}">${getInitials(name)}</div> `;

        $(".selected-reporter").html(` ${avatar} <span class="user-name ms-2">${name}</span>`);

        const taskId = $("#modalTaskID").val().trim();
        updateTaskReporter(taskId, reporterId);

    });

    // handle click for reviewer
    $(document).on("click", ".reviewer-user-list .dropdown-item", function () {

        let name = $(this).data("name");
        let reviewerId = $(this).data("id");

        let avatar = `<div class="assignee-avatar-sm profile-image" data-user-id="${reviewerId}">${getInitials(name)}</div> `;

        $(".selected-reviewer").html(`  ${avatar}  <span class="user-name ms-2">${name}</span>`);

        const taskId = $("#modalTaskID").val().trim();
        updateTaskReviewer(taskId, reviewerId);

    });
    //handle click of task user in  task subtask table
    $(document).on("click", ".subtask-user-list .dropdown-item", function () {
        //debugger;
        let name = $(this).data("name");
        let selectedUserId = $(this).data("id");

        let avatar = `<div class="assignee-avatar-sm" data-id="${selectedUserId}">${getInitials(name)}</div> `;

        $(this).closest(".dropdown").find(".subtask-selected-assignee").html(` ${avatar} <span class="user-name ms-2">${name}</span> `);

        const selectedRowTaskId = $(this).closest("tr").data("id");

        updateTaskAssignee(selectedRowTaskId, selectedUserId);
    });


    // Priority dropdown
    $(document).on('click', '.priority-option', function () {

        let selectedText = $(this).find('.user-name').text();
        let selectedIcon = $(this).find('.priority-icon-item').data('icon');
        let selectedColor = $(this).find('.priority-icon-item').data('color');

        // Update icon + color
        $('.priority-icon')
            .removeClass()
            .addClass('priority-icon bi ' + selectedIcon)
            .css('color', selectedColor);

        // Update text
        $('#selectedPriority').text(selectedText);
    });
    //handle click of task status
    $(document).on("click", ".select-status .dropdown-item", function () {
        // get values from clicked element
        var selectedStatusId = $(this).data("id");
        var text = $(this).text().trim();

        // update selected text
        $(".btn-task-status").attr("data-id", selectedStatusId);
        $(".btn-task-status span").text(text);

        const taskId = $("#modalTaskID").val().trim();
        updateTaskStatus(taskId, selectedStatusId);

    });


    //handle click of task status in  task subtask table
    $(document).on("click", ".select-task-subTask-status .dropdown-item", function () {
        // get values from clicked element
        var id = $(this).data("id");
        var text = $(this).text().trim();

        // update selected text
        const $dropdown = $(this).closest(".dropdown");
        $dropdown.find(".btn-task-subtask-status").attr("data-id", id);
        $dropdown.find(".btn-task-subtask-status span").text(text);

        // find nearest row
        const selectedRowTaskId = $(this).closest("tr").data("id");

        updateTaskStatus(selectedRowTaskId, id);

    });
    // hnadle click Epic  dropdown in modal
    $(document).on('click', '.selecte-epic', function () {
        //debugger;
        let code = $(this).data("code");
        let epicId = $(this).data("id");

        // Update text
        $('.selected-epic-code span').text(code);
        $('.selected-epic-code').attr('data-id', epicId);


        const taskId = $("#modalTaskID").val().trim();
        updateTaskParent(taskId, epicId);

    });
    //add subtask row to create subtask inside task
    $(document).on("click", "#btnAddChildWork", function (e) {
        // Stop click from propagating to parent elements
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();

        getTaskTypes();
        // loadTaskTypeDropdown();

        const $tbody = $("#childWorkTableTbody");

        // Prevent multiple add rows
        if ($tbody.find(".child-add-row").length) return;

        const rowHtml = `
                            <tr class="child-add-row">
                              <td colspan="5">
                                <div class="d-flex align-items-center gap-2 child-add-wrapper">
                                <form id="subTaskForm">
                                  <input tabindex="0" type="text" class="form-control child-add-input" placeholder="What needs to be done?" id="childWorkTitle" required/>
                                 </form>
                                  <!-- Epic/Task/Bug dropdown -->
                                          <div class="dropdown">
                                                <a class="text-decoration-none icon-btn dropdown-toggle child-task-type task-type-btn default-selected-value" data-bs-toggle="dropdown" id="childTaskTypeID" >
                                                      <i class=""></i><span class="ms-2 text-black"></span>
                                              </a>

                                          </div>
                                  <span class="child-add-action">
                                   <span  tabindex="0"  onclick="createTask('subTask');"  onkeypress="if(event.key==='Enter') createTask('subTask')"> <i class="bi bi-arrow-return-left"></i>  </span>
                                  </span>
                                </div>
                              </td>
                            </tr>
                          `;

        $tbody.append(rowHtml);

        // Auto focus
        $tbody.find(".child-add-input").focus();
    });


    function updateTask() {
        // debugger;
        const id = $("#modalTaskID").val();
        const taskTitle = $("#modalTaskTitle").val().trim();
        const taskDescription = tinymce.get('DescriptionEditor').getContent() //quill.root.innerHTML;
        const assignedId = $("#modalAssigneeID .profile-image").data("user-id");
        const reviewerId = $("#modalReviewerID .profile-image").data("user-id");
        const reporterId = $("#modalReporterID .profile-image").data("user-id");
        const statusId = $('.btn-task-status').data("id");


        let url = `flowtick/project/${projectId}/tasks/${id}`;
        apiRequest({
            url: url,
            type: 'PUT',
            data: {
                "title": taskTitle,
                "description": taskDescription,
                "assigneeId": assignedId,
                "statusId": statusId,
                "reviewerId": reviewerId,
                "reporterId": reporterId,
                "parentId": null
            },
            callBack: updateTaskCallBack
        });

    }
    var updateTaskCallBack = function (response) {
        if (response.request.status === 204) {
            successToastr("Saved successfully", 'Task');
            getProjectTasks();

        }
        else {
            errorExtractor(response);
        }
    };

    function updateTaskStatus(taskId, selectedStatusId) {

        let url = `flowtick/tasks/${taskId}/status`;
        apiRequest({
            url: url,
            type: 'PUT',
            data: {
                "statusId": selectedStatusId
            },
            callBack: updateTaskStatusCallBack
        });
    }
    var updateTaskStatusCallBack = function (response) {
        if (response.request.status === 204) {
            successToastr("Changed successfully", 'Status');
            getProjectTasks();
        }
        else {
            errorExtractor(response);
        }
    };


    function updateTaskReporter(taskId, reporterId) {

        let url = `flowtick/tasks/${taskId}/reporter`;
        apiRequest({
            url: url,
            type: 'PUT',
            data: {
                "reporterId": reporterId
            },
            callBack: updateTaskReporterCallBack
        });
    }
    var updateTaskReporterCallBack = function (response) {
        if (response.request.status === 204) {
            successToastr("Assigned successfully", 'Reporter');
            getProjectTasks();
        }
        else {
            errorExtractor(response);
        }
    };

    function updateTaskReviewer(taskId, reviewerId) {

        let url = `flowtick/tasks/${taskId}/reviewer`;
        apiRequest({
            url: url,
            type: 'PUT',
            data: {
                "reviewerId": reviewerId
            },
            callBack: updateTaskReviewerCallBack
        });
    }
    var updateTaskReviewerCallBack = function (response) {
        if (response.request.status === 204) {
            successToastr("Assigned successfully", 'Reviewer');
            getProjectTasks();
        }
        else {
            errorExtractor(response);
        }
    };

    function updateTaskParent(taskId, selectedEpicId) {
        let url = `flowtick/tasks/${taskId}/parent`;
        apiRequest({
            url: url,
            type: 'PUT',
            data: {
                "parentId": selectedEpicId
            },
            callBack: updateTaskParentCallBack
        });
    }
    var updateTaskParentCallBack = function (response) {
        if (response.request.status === 204) {
            successToastr("Assigned successfully", 'Parent');
            getProjectTasks();
        }
        else {
            errorExtractor(response);
        }
    };
    function loadChildTasks(taskId = 0) {
        if (taskId <= 0) {
            return;
        }

        let url = `flowtick/tasks/${taskId}/child`;
        apiRequest({
            url: url,
            type: 'GET',
            data: {},
            callBack: function (response) {
                debugger;
                if (response.request.status === 200) {
                    loadChildTasksTable(response.data.parent, response.data);
                } else {
                    errorExtractor(response);
                }
            }

        });
    }
    function addComment(taskId){
        // alert(taskId);
          const commentDescription = tinymce.get('Comment').getContent()
        
           let url = `flowtick/task/${taskId}/comments`;
             apiRequest({
            url: url,
            type: 'POST',
            data: {
                "comment": commentDescription
            },
            callBack: addCommentCallBack
        });
    }

    var addCommentCallBack = function (response) {
        if (response.request.status === 201) {
          successToastr("saved successfully", 'success');
            //  Clear  editor
         tinymce.get('Comment').setContent('');

        // Move cursor to editor
        tinymce.get('Comment').focus();
            getProjectTasks();
        }
        else {
            errorExtractor(response);
        }
    };

     function renderComments(comments) {
        const $wrapper = $(".comments-container");
        $wrapper.empty();

        $.each(comments, function (index, comment) {
        const isLoginUser = comment.userId === Number(loginUserID);
            const sideClass = isLoginUser ? "right" : "left";
            const userName = "Usman said"
            const html = `
                <div class="comment-item ${sideClass}" data-id="${comment.id}">

                    <div class="comment-user-img">${getInitials(userName)}</div>

                    <div class="comment-bubble">
                        <div class="comment-header">
                            <span class="user-name">${userName}</span>
                            <span class="comment-meta">
                                <span class="date">${comment.date}</span>
                                <span class="time">${comment.time}</span>
                            </span>
                        </div>

                        <div class="comment-text">
                            ${comment.comment}
                        </div>
                    </div>

                </div>
            `;

            $wrapper.append(html);
        });
    }

</script>